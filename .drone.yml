---
kind: pipeline
type: kubernetes
name: default

steps:
- name: preview
  image: pulumi/pulumi:latest
  commands:
    - pip install -r requirements.txt
    - pulumi preview --stack digitalocean --non-interactive
  environment:
    PULUMI_ACCESS_TOKEN:
      from_secret: PULUMI_ACCESS_TOKEN
  when:
    event:
      include:
        - pull_request
